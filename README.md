# 🔐 セキュア暗号資産ポートフォリオアプリ

暗号化機能付きの暗号資産ポートフォリオ管理Webアプリケーションです。パスワード認証、データ暗号化、自動ログアウト機能により、あなたの資産情報を安全に保護します。

## ✨ セキュリティ機能

### 🔐 データ暗号化
- **AES-256-GCM暗号化**: 保有量、メモ、場所IDを暗号化してIndexedDBに保存
- **PBKDF2-SHA256**: パスワードハッシュ化に150,000回の反復処理
- **透明な暗号化**: UIや既存機能への影響なし
- **自動マイグレーション**: 既存データの暗号化を初回ログイン時に実行

### 🔑 パスワード認証
- **初回セットアップ**: 8文字以上の強力なパスワード設定
- **ログイン**: セキュアなパスワード認証でデータアクセス
- **パスワード強度**: リアルタイム強度判定とガイダンス
- **パスワード変更**: 設定画面からのパスワード更新
- **データリセット**: 全データ削除によるパスワードリセット

### ⏰ 自動ログアウト
- **30分タイマー**: 非アクティブ状態で自動ログアウト
- **5分前警告**: セッション延長または即座ログアウトの選択
- **アクティビティ検知**: マウス、キーボード、タッチ操作を監視
- **タブ終了時**: ブラウザタブ閉じでの自動ログアウト

### ☁️ Google Driveクラウド同期
- **セキュア同期**: 独立したクラウドパスワードによる暗号化
- **自動同期**: 5分間隔の自動バックアップ
- **競合解決**: ローカル・クラウドデータの競合検出と解決
- **クロスデバイス**: 複数デバイス間でのデータ共有
- **エラーハンドリング**: ネットワークエラーや認証失敗の適切な処理

## 💼 ポートフォリオ機能

### 🪙 通貨管理
- **多様な保管場所**: 国内取引所、海外取引所、ウォレット対応
- **通貨追加**: CoinGecko APIを使用した通貨検索と自動補完
- **保有量管理**: 場所別の詳細な保有量記録
- **メモ機能**: 各保有に対する自由なメモ入力

### 📊 価格取得と計算
- **前日終値**: CoinGecko APIから前日の終値を取得
- **自動換算**: USD価格を為替レートでJPY換算
- **キャッシュ機能**: 12時間の価格キャッシュでAPI呼び出しを最適化
- **集計表示**: 通貨別の合計保有量と評価額

### 🎨 UI/UX
- **セッション表示**: 認証状態、残り時間、クラウド同期状態の表示
- **レスポンシブデザイン**: デスクトップ・モバイル対応
- **ダークモード**: システム設定に応じた自動切り替え
- **PWA対応**: オフライン利用可能
- **日本語UI**: 全てのラベルとメッセージが日本語
- **クラウド同期UI**: 直感的な同期設定と状態表示

## 技術スタック

- **フロントエンド**: Vue 3 + TypeScript + Vite
- **状態管理**: Pinia
- **スタイリング**: Tailwind CSS
- **データベース**: IndexedDB (Dexie.js)
- **暗号化**: Web Crypto API (AES-256-GCM, PBKDF2-SHA256) + crypto-js
- **クラウド**: Google Drive API v3
- **API**: CoinGecko API
- **PWA**: @vite-pwa/vue

## セットアップ

### 前提条件
- Node.js 18以上
- pnpm または npm
- Google Cloud Projectの設定（クラウド同期機能を使用する場合）

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/ekumaki/my-crypto-valuation.git
cd my-crypto-valuation

# 依存関係をインストール
pnpm install
# または
npm install
```

### 開発サーバーの起動

```bash
# 開発サーバーを起動
pnpm dev
# または
npm run dev
```

ブラウザで `http://localhost:5173` にアクセスしてアプリケーションを表示できます。

### ビルド

```bash
# プロダクションビルド
pnpm build
# または
npm run build
```

### プレビュー

```bash
# ビルドしたアプリをプレビュー
pnpm preview
# または
npm run preview
```

### Google Drive同期の設定（オプション）

クラウド同期機能を使用するには、Google Cloud Consoleでの設定が必要です：

1. [Google Cloud Console](https://console.cloud.google.com/)でプロジェクトを作成
2. Google Drive APIを有効化
3. 認証情報を作成（OAuth 2.0クライアントID）
4. 環境変数を設定：

```bash
# .env ファイルを作成
VITE_GOOGLE_CLIENT_ID=your_google_client_id
VITE_GOOGLE_API_KEY=your_google_api_key
```

## 使用方法

### 🔐 初回セットアップ
1. アプリケーションにアクセス
2. 8文字以上のセキュアなパスワードを設定
3. パスワード強度を確認し、「パスワードを設定」をクリック
4. 既存データがある場合、自動的に暗号化されます

### 🔑 ログイン
1. 設定したパスワードを入力
2. 「ログイン」ボタンをクリック
3. 認証成功後、ポートフォリオ画面に移動
4. セッションタイマーが開始されます

### 💰 保有量の管理
1. 「保有数量入力」タブに移動
2. 「保有を追加」ボタンをクリック
3. 保管場所を選択（取引所・ウォレット等）
4. 通貨を検索・選択
5. 保有量とメモ（任意）を入力
6. 「追加」ボタンで確定

### 📊 ポートフォリオ確認
1. 「ポートフォリオ」タブで資産一覧を確認
2. 「最新価格を取得」で価格を更新
3. 通貨別の保有量と評価額を確認
4. 総資産額をリアルタイムで確認

### ☁️ Google Drive同期の設定
1. 上部ナビゲーションの「クラウド同期」ボタンをクリック
2. 「Googleでサインイン」でGoogle認証を実行
3. 「クラウド同期を有効にする」をクリック
4. 強力なクラウドパスワードを設定
5. 自動同期が開始されます

### ⚙️ 設定とセキュリティ
- **パスワード変更**: セッションバナーの「設定」→「パスワード変更」
- **ログアウト**: セッションバナーの「設定」→「ログアウト」
- **データリセット**: ログイン画面の「すべてのデータをリセット」
- **セッション延長**: 25分後の警告バナーで「セッション延長」
- **クラウド同期**: 「今すぐ同期」ボタンで手動同期実行
- **競合解決**: データ競合時の自動解決ウィザード

## データストレージとセキュリティ

### 暗号化されたデータ
アプリケーションはブラウザのIndexedDBを使用してデータを保存します：

- **locations**: 保管場所情報（平文）
- **holdings**: 保有量、メモ、保管場所ID（**AES-256-GCM暗号化**）
- **prices**: 価格履歴とキャッシュ（平文）
- **認証情報**: パスワードハッシュとソルト（localStorage）

### クラウドデータの暗号化
Google Driveに保存されるデータは追加の暗号化層で保護されます：

- **独立暗号化**: アプリパスワードとは別のクラウドパスワード
- **多重暗号化**: ローカル暗号化 + クラウド暗号化の二重保護
- **プライバシー保護**: Google側でもデータ内容を読み取り不可
- **安全な転送**: HTTPS通信による暗号化転送

### セキュリティ仕様
- **暗号化アルゴリズム**: AES-256-GCM（ローカル・クラウド両対応）
- **鍵導出**: PBKDF2-SHA256（150,000回反復）
- **パスワードハッシュ**: SHA-256
- **セッション管理**: インメモリ暗号化キー
- **自動ログアウト**: 30分間のアイドルタイムアウト
- **クラウド認証**: OAuth 2.0 (Google Drive API)
- **エラーハンドリング**: 包括的なエラー処理とユーザーフィードバック

## API仕様

### CoinGecko API
- **検索エンドポイント**: `/api/v3/search`
- **価格エンドポイント**: `/api/v3/simple/price`
- **履歴エンドポイント**: `/api/v3/coins/{id}/history`
- **為替レート**: `/api/v3/exchange_rates`

### Google Drive API
- **認証**: OAuth 2.0 with PKCE
- **ファイル操作**: `/drive/v3/files`
- **アップロード**: `/upload/drive/v3/files`
- **スコープ**: `drive.file`, `drive.appdata`
- **レート制限**: 1秒あたり100リクエスト

## パフォーマンス

- **初期表示**: 3秒以内（10通貨以下）
- **オフライン対応**: PWAによるキャッシュ機能
- **レスポンシブ**: Chrome・Edge最新版で最適化

## セキュリティ検証

### ✅ 実装完了
- [x] **データ暗号化**: AES-256-GCM による保有量・メモ・場所IDの暗号化
- [x] **パスワード認証**: PBKDF2-SHA256 によるセキュアなパスワード管理
- [x] **自動ログアウト**: 30分アイドルタイムアウト + 5分前警告
- [x] **セッション管理**: インメモリ暗号化キー + アクティビティ監視
- [x] **データ移行**: 既存データの自動暗号化
- [x] **Google Drive同期**: OAuth認証 + 暗号化クラウドバックアップ
- [x] **競合解決**: 自動検出 + ユーザー選択式解決
- [x] **エラーハンドリング**: 包括的エラー処理とユーザーフィードバック
- [x] **クロスデバイス**: 複数デバイス間でのセキュアなデータ共有

### 🔍 DevToolsでの検証方法
1. F12でDevToolsを開く
2. Application → Storage → IndexedDB → cryptoPortfolioV2
3. holdingsテーブルを確認
4. `encryptedQuantity`, `encryptedLocationId`, `encryptedNote` が暗号化されていることを確認

## パフォーマンス

- **暗号化/復号化**: 100件あたり150ms以下（要件: ≤150ms）
- **初期表示**: 3秒以内（10通貨以下）
- **オフライン対応**: PWAによるキャッシュ機能
- **レスポンシブ**: Chrome・Edge最新版で最適化

## 今後の機能拡張

現在、以下の機能が計画されています：

- [ ] 前日比表示
- [ ] 資産推移グラフ（Chart.js）
- [ ] CSV エクスポート機能（暗号化対応）
- [ ] 複数ポートフォリオ対応
- [ ] 高度な競合解決（ファイル差分表示）
- [ ] クラウド同期ログとエラー履歴
- [ ] 他のクラウドストレージ対応（Dropbox、OneDrive）

## ライセンス

MIT License - 詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 貢献

プルリクエストやイシューの報告を歓迎します。

## サポート

問題が発生した場合は、GitHubのIssuesページで報告してください。

---

**注意**: このアプリケーションは教育目的で作成されています。投資判断は自己責任で行ってください。